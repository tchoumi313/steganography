import numpy as np
from PIL import Image


def lsb_embed(image_path, secret_message):
    image = Image.open(image_path)
    image = image.convert("RGB")
    data = np.array(image)
    
    # Convert secret message to binary
    binary_message = ''.join(format(ord(char), '08b') for char in secret_message) + '11111111'  # End marker
    data_flat = data.flatten()
    
    for i in range(len(binary_message)):
        data_flat[i] = (data_flat[i] & ~1) | int(binary_message[i])
    
    data_embedded = data_flat.reshape(data.shape)
    stego_image = Image.fromarray(data_embedded)
    stego_image.save("../output/lsb/stego_image.png")

def lsb_extract(stego_image_path):
    stego_image = Image.open(stego_image_path)
    data = np.array(stego_image)
    data_flat = data.flatten()
    print(data_flat)
    binary_message = ""
    for pixel in data_flat:
        binary_message += str(pixel & 1)
    
    # Split the binary message into bytes
    message_bytes = [binary_message[i:i + 8] for i in range(0, len(binary_message), 8)]
    secret_message = ""
    
    for byte in message_bytes:
        if byte == '11111111':  # End marker
            break
        secret_message += chr(int(byte, 2))
    
    return secret_message

# Example usage
#lsb_embed("../input/example.png", "MY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothingMY Secret Message is all about nothing")
print(lsb_extract("../output/lsb/stego_image.png"))